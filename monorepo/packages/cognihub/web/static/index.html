<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CogniHub</title>

  <link rel="icon" href="data:," />

  <link rel="stylesheet" href="/static/styles.css?v=4" />

</head>

<body>
  <div id="sidebarOverlay" class="sidebarOverlay hidden"></div>

  <!-- Sidebar: Navigation + context panels -->
  <aside id="sidebar" class="sidebar closed">
    <div class="sidebarTop">
      <div class="sidebarBrand">CogniHub</div>
      <button id="btnSidebarClose" class="iconbtn">âœ•</button>
    </div>

    <div class="sidebarNav" aria-label="Primary navigation">
      <button id="navHome" class="navItem" type="button">Home</button>
      <button id="navChat" class="navItem active" type="button">Chat</button>
      <button id="navLibrary" class="navItem" type="button">Library</button>
      <button id="navModels" class="navItem" type="button">Models</button>
      <button id="navSettingsNav" class="navItem" type="button">Settings</button>
    </div>

    <div class="sidebarTabs">
      <button id="tabChats" class="tab active">Chats</button>
      <button id="tabDocs" class="tab">Docs</button>
      <!-- kept for JS compatibility -->
      <button id="tabSettings" class="tab hidden">Settings</button>
    </div>

    <div id="panelChats" class="sidebarPanel">
      <div class="row">
        <button id="btnNewChat" class="btn">New chat</button>
        <label class="checkbox"><input id="showArchived" type="checkbox" />Archived</label>
      </div>

      <div class="row">
        <div class="export-dropdown">
          <button id="btnExportChat" class="btn">Export</button>
          <div id="exportMenu" class="export-menu hidden">
            <button class="export-option" data-format="md">Markdown</button>
            <button class="export-option" data-format="json">JSON</button>
            <button class="export-option" data-format="txt">Plain text</button>
          </div>
        </div>
        <button id="btnClear" class="btn danger">Clear</button>
      </div>

      <input id="chatSearch" class="input" placeholder="Search chats" />
      <div id="chatList" class="list"></div>
    </div>

    <div id="panelDocs" class="sidebarPanel hidden">
      <input id="fileUpload" type="file" class="input file" multiple />
      <div class="row">
        <button id="btnDocsAll" class="btn">All</button>
        <button id="btnDocsNone" class="btn">None</button>
      </div>
      <div id="docsList" class="list"></div>
    </div>
  </aside>

  <div class="app">
    <header class="topbar">
      <div class="topLeft">
        <button id="btnSidebar" class="iconbtn">â˜°</button>
        <div class="brandBlock">
        <div class="brand">CogniHub</div>
        <div class="subtitle"><span id="statusDot"></span><span id="statusText">Idle</span></div>
      </div>
    </div>

      <div class="topRight">
        <button id="btnChatsPage" class="chip" type="button" title="Chats">Chats</button>
        <button id="btnModelQuick" class="chip" type="button" title="Model settings">
          <span class="chipLabel">Model</span>
          <span id="currentModelLabel" class="chipValue">â€”</span>
        </button>

        <button id="btnSettings" class="iconbtn" title="Settings">âš™</button>
        <button id="btnHelp" class="iconbtn" title="Help">?</button>
        <button id="btnTheme" class="iconbtn">ðŸŒ“</button>
      </div>
    </header>

    <main class="main">
      <section id="pageHome" class="page">
        <div class="pageHead">
          <h1 class="pageTitle">Welcome to CogniHub</h1>
          <div class="pageLead">Local-first chat + tools + offline knowledge. Pick where to start.</div>
        </div>

        <div class="cardGrid">
          <div class="card">
            <div class="cardTitle">Start a chat</div>
            <div class="cardBody">Create a new chat, or jump back into the last one.</div>
            <div class="cardActions">
              <button id="homeNewChat" class="btn primary" type="button">New chat</button>
              <button id="homeGoChat" class="btn" type="button">Open chat</button>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Library</div>
            <div class="cardBody">Upload docs, browse Kiwix ZIMs, and ingest EPUBs for RAG.</div>
            <div class="cardActions">
              <button id="homeGoLibrary" class="btn" type="button">Open library</button>
            </div>
          </div>

          <div class="card">
            <div class="cardTitle">Settings</div>
            <div class="cardBody">Configure chat defaults, tools, sources, and the UI.</div>
            <div class="cardActions">
              <button id="homeGoSettings" class="btn" type="button">Open settings</button>
            </div>
          </div>
        </div>
      </section>

      <section id="pageChat" class="page hidden">
        <div id="chat" class="chat"></div>
        <div id="scrollHint" class="scroll-hint hidden">New messages</div>
        <button id="scrollToBottomBtn" class="scroll-to-bottom-btn hidden">â†“ <span id="scrollCount"></span></button>
      </section>

      <section id="pageLibrary" class="page hidden">
        <div class="pageHead">
          <h1 class="pageTitle">Library</h1>
          <div class="pageLead">Offline + personal sources. Docs are in the sidebar; ZIMs and EPUBs live here.</div>
        </div>

        <div class="cardGrid">
          <div class="card">
            <div class="cardTitle">Kiwix ZIMs</div>
            <div class="cardBody">List local ZIM files from a directory.</div>
            <div class="row">
              <input id="kiwixZimDir" class="input" placeholder="e.g. ~/zims or /path/to/zims" />
              <button id="btnReloadZims" class="btn" type="button">Reload</button>
            </div>
            <div id="zimsList" class="list"></div>
          </div>

          <div class="card">
            <div class="cardTitle">EPUB (Calibre)</div>
            <div class="cardBody">Search your Calibre library and ingest books into RAG.</div>
            <div class="row">
              <input id="ebooksDir" class="input" placeholder="e.g. ~/Ebooks or /path/to/ebooks" />
            </div>
            <div class="row">
              <input id="epubQuery" class="input" placeholder="Search by path / author / title" />
              <button id="btnReloadEpubs" class="btn" type="button">Search</button>
            </div>
            <div class="row">
              <button id="btnIngestTopEpub" class="btn primary" type="button">Ingest top match</button>
              <span id="epubStatus" class="muted"></span>
            </div>
            <div id="epubsList" class="list"></div>
          </div>
        </div>
      </section>

      <section id="pageModels" class="page hidden">
        <div class="pageHead">
          <h1 class="pageTitle">Models</h1>
          <div class="pageLead">Available Ollama models from your server.</div>
        </div>
        <div class="card">
          <div class="row">
            <button id="btnReloadModels" class="btn" type="button">Refresh</button>
          </div>
          <div id="modelsList" class="list"></div>
        </div>
      </section>

      <section id="pageSettings" class="page hidden">
        <div class="pageHead">
          <h1 class="pageTitle">Settings</h1>
          <div class="pageLead">Everything configurable lives here. Changes are stored locally unless noted.</div>
        </div>
        <div id="settingsMount"></div>
      </section>

      <section id="pageChats" class="page hidden">
        <div class="pageHead">
          <h1 class="pageTitle">Chats</h1>
          <div class="pageLead">Search, organize, export, and manage chats without the sidebar.</div>
        </div>
        <div id="chatsMount"></div>
      </section>

      <section id="pageHelp" class="page hidden">
        <div class="pageHead">
          <h1 class="pageTitle">Help</h1>
          <div class="pageLead">Shortcuts, slash commands, and quick diagnostics.</div>
        </div>
        <div id="helpMount"></div>
      </section>
    </main>

    <div id="composer" class="composer">
      <div id="slashPalette" class="slashPalette hidden"></div>
      <textarea id="prompt" class="input" rows="2" placeholder="Type a messageâ€¦"></textarea>
      <div class="composerBtns">
        <button id="btnSend" class="btn primary">Send</button>
        <button id="btnStop" class="btn danger hidden">Stop</button>
        <button id="btnEditLast" class="btn">Edit last</button>
      </div>
    </div>
  </div>

<!-- Settings (mounted into Settings page at runtime) -->
<div id="settingsOverlay" class="modalOverlay hidden"></div>

<div id="settingsModal" class="modal hidden settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
  <div class="modalCard">
  <div class="modalHead settingsHead">
    <div class="settingsTitleWrap">
      <div id="settingsTitle" class="modalTitle settingsTitle">Settings</div>
      <div class="settingsSubtitle">Make it feel like *your* cockpit.</div>
    </div>
    <button id="btnSettingsClose" class="iconbtn fancyClose" aria-label="Close settings">âœ•</button>
  </div>

  <div class="modalBody settingsBody">
    <!-- Tabs -->
    <div class="settingsTabs" role="tablist" aria-label="Settings tabs">
      <button class="settingsTab active" type="button" data-settings-tab="ui" role="tab" aria-selected="true">UI</button>
      <button class="settingsTab" type="button" data-settings-tab="chat" role="tab" aria-selected="false">Chat</button>
      <button class="settingsTab" type="button" data-settings-tab="model" role="tab" aria-selected="false">Model</button>
      <button class="settingsTab" type="button" data-settings-tab="sources" role="tab" aria-selected="false">Sources</button>
      <button class="settingsTab" type="button" data-settings-tab="privacy" role="tab" aria-selected="false">Privacy</button>
    </div>

    <!-- Panels -->
    <div class="settingsPanels">
      <!-- UI -->
      <section class="settingsPanel" data-settings-panel="ui">
        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Look & feel</div>
            <div class="cardHint">Small stuff that makes the app feel expensive.</div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="uiFontSize">Font size</label>
              <select id="uiFontSize" class="input">
                <option value="sm">Small</option>
                <option value="md" selected>Medium</option>
                <option value="lg">Large</option>
              </select>
            </div>

            <div class="field">
              <label for="uiDensity">Density</label>
              <select id="uiDensity" class="input">
                <option value="cozy" selected>Cozy</option>
                <option value="compact">Compact</option>
              </select>
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="uiChatWidth">Chat width</label>
              <select id="uiChatWidth" class="input">
                <option value="comfortable" selected>Comfortable</option>
                <option value="wide">Wide</option>
                <option value="full">Full</option>
              </select>
            </div>

            <div class="field">
              <label for="uiCodeWrap">Code blocks</label>
              <select id="uiCodeWrap" class="input">
                <option value="nowrap" selected>No wrap</option>
                <option value="wrap">Wrap long lines</option>
              </select>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="uiReduceMotion" type="checkbox" />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Reduce motion</div>
              <div class="settingDesc">Less animation, more focus.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Chat -->
      <section class="settingsPanel hidden" data-settings-panel="chat">
        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Chat behavior</div>
            <div class="cardHint">Control what shows up + how it behaves.</div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="chatShowTimestamps" type="checkbox" />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Show timestamps</div>
              <div class="settingDesc">Adds times next to messages.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="chatAutoScroll" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Auto-scroll while generating</div>
              <div class="settingDesc">Stays pinned to the newest message.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="chatRenderMarkdown" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Render Markdown</div>
              <div class="settingDesc">Code blocks + formatting.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="chatInlineSources" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Show sources inline</div>
              <div class="settingDesc">RAG sources appear under responses.</div>
            </div>
          </div>
        </div>

        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Composer</div>
            <div class="cardHint">How sending works.</div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="sendKey">Send key</label>
              <select id="sendKey" class="input">
                <option value="ctrlenter" selected>Ctrl+Enter</option>
                <option value="enter">Enter (Shift+Enter newline)</option>
              </select>
            </div>

            <div class="field">
              <label for="slashBehavior">Slash palette</label>
              <select id="slashBehavior" class="input">
                <option value="on" selected>Enabled</option>
                <option value="off">Disabled</option>
              </select>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="confirmClearChat" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Confirm before clearing a chat</div>
              <div class="settingDesc">Prevents "oops".</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Model -->
      <section class="settingsPanel hidden" data-settings-panel="model">
        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Model selection</div>
            <div class="cardHint">Choose a model, or let CogniHub decide automatically.</div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="modelSelect">Model</label>
              <select id="modelSelect" class="input"></select>
            </div>

            <div class="field">
              <label for="presetSelect">Preset</label>
              <select id="presetSelect" class="input"></select>
              <div class="help">Applies recommended generation + RAG defaults.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="autoModelToggle" type="checkbox" />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Auto model selection</div>
              <div class="settingDesc">Let the backend pick a model per message.</div>
            </div>
          </div>
        </div>

        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Personality</div>
            <div class="cardHint">This affects the assistant's behavior for *this app*.</div>
          </div>

          <div class="field">
            <label for="systemPrompt">System prompt</label>
            <textarea id="systemPrompt" class="input textarea" rows="4" placeholder="Optional system promptâ€¦"></textarea>
          </div>
        </div>

        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Generation</div>
            <div class="cardHint">Performance vs creativity.</div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="temperature">Temperature</label>
              <input id="temperature" class="input" type="number" step="0.05" min="0" max="2" />
            </div>

            <div class="field">
              <label for="numCtx">Context (num_ctx)</label>
              <input id="numCtx" class="input" type="number" step="256" min="256" />
            </div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="keepAlive">Keep-alive</label>
              <input id="keepAlive" class="input" type="text" placeholder="e.g., 0 / 5m / 1h" />
              <div class="help">0 disables keep-alive.</div>
            </div>

            <div class="field">
              <label for="topK">Top-K (RAG)</label>
              <input id="topK" class="input" type="number" step="1" min="1" />
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="ragToggle" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Enable RAG</div>
              <div class="settingDesc">Retrieve from docs for better answers.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="mmrToggle" type="checkbox" />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">MMR re-rank</div>
              <div class="settingDesc">Better diversity, fewer duplicates.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- Privacy -->
      <section class="settingsPanel hidden" data-settings-panel="privacy">
        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Local data</div>
            <div class="cardHint">This is just your browser storage.</div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="persistChats" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Save chats locally</div>
              <div class="settingDesc">Keeps state between reloads.</div>
            </div>
          </div>

          <div class="settingRow">
            <label class="switch">
              <input id="persistSettings" type="checkbox" checked />
              <span class="slider"></span>
            </label>
            <div class="settingText">
              <div class="settingName">Save settings locally</div>
              <div class="settingDesc">Your preferences persist.</div>
            </div>
          </div>

          <div class="row">
            <button id="btnExportAllChats" class="btn">Export all chats</button>
            <button id="btnWipeLocal" class="btn danger">Wipe local data</button>
          </div>
        </div>
      </section>

      <!-- Sources -->
      <section class="settingsPanel hidden" data-settings-panel="sources">
        <div class="settingsCard">
          <div class="cardHead">
            <div class="cardTitle">Offline sources</div>
            <div class="cardHint">Used by the Library page. Defaults match your server, but you can override locally.</div>
          </div>

          <div class="grid2">
            <div class="field">
              <label for="srcZimDir">ZIM directory</label>
              <input id="srcZimDir" class="input" type="text" placeholder="e.g. ~/zims or /path/to/zims" />
              <div class="help">Used by Kiwix ZIM listing.</div>
            </div>

            <div class="field">
              <label for="srcEbooksDir">Calibre library</label>
              <input id="srcEbooksDir" class="input" type="text" placeholder="e.g. ~/Ebooks or /path/to/ebooks" />
              <div class="help">Used by EPUB search + ingest.</div>
            </div>
          </div>

          <div class="field">
            <label for="srcKiwixUrl">Kiwix URL</label>
            <input id="srcKiwixUrl" class="input" type="text" placeholder="http://127.0.0.1:8081" />
            <div class="help">Optional override (if you run multiple kiwix-serve instances).</div>
          </div>
        </div>
      </section>
    </div>

    <div class="settingsFooter">
      <div class="settingsGlow"></div>
      <button id="btnResetSettings" class="btn">Reset</button>
      <button id="btnSaveSettings" class="btn primary">Save</button>

      <!-- Keep legacy container in DOM if anything queries it -->
      <div id="panelSettings" class="hidden" aria-hidden="true"></div>
    </div>
  </div>

  </div>
</div>


  <!-- Generic modal (used for Sources + misc) -->
  <div id="modalOverlay" class="modalOverlay hidden" aria-hidden="true"></div>
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalCard">
      <div class="modalHead">
        <div id="modalTitle" class="modalTitle">Modal</div>
        <button id="btnModalClose" class="iconbtn fancyClose" type="button" aria-label="Close modal">âœ•</button>
      </div>
      <pre id="modalBody" class="modalBody"></pre>
    </div>
  </div>

  <!-- Shortcuts / help -->
  <div id="shortcutsOverlay" class="modalOverlay hidden" aria-hidden="true"></div>
  <div id="shortcutsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="shortcutsTitle">
    <div class="modalCard">
      <div class="modalHead">
        <div id="shortcutsTitle" class="modalTitle">Shortcuts</div>
        <button id="btnShortcutsClose" class="iconbtn fancyClose" type="button" aria-label="Close shortcuts">âœ•</button>
      </div>

      <div class="shortcutsBody">
        <div class="shortcutsGrid">
          <div class="shortcutRow">
            <div class="shortcutLabel">Send message</div>
            <div class="kbd"><span>Ctrl</span><span>Enter</span></div>
          </div>
          <div class="shortcutRow">
            <div class="shortcutLabel">Open chat search</div>
            <div class="kbd"><span>Ctrl</span><span>K</span></div>
          </div>
          <div class="shortcutRow">
            <div class="shortcutLabel">New chat</div>
            <div class="kbd"><span>Ctrl</span><span>N</span></div>
          </div>
          <div class="shortcutRow">
            <div class="shortcutLabel">Edit last user msg</div>
            <div class="kbd"><span>Ctrl</span><span>E</span></div>
          </div>
          <div class="shortcutRow">
            <div class="shortcutLabel">Show this help</div>
            <div class="kbd"><span>Ctrl</span><span>/</span></div>
          </div>
          <div class="shortcutRow">
            <div class="shortcutLabel">Close dialogs / stop generating</div>
            <div class="kbd"><span>Esc</span></div>
          </div>
        </div>

        <div class="help" style="margin-top:12px;margin-left:2px;">
          Tip: type <code class="inline">/</code> in the prompt to use slash commands.
        </div>
      </div>
    </div>
  </div>


  <script src="/static/app.js?v=9"></script>

  <div id="toastHost" class="toastHost" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
